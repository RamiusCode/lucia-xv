<section class="relative bg-white text-black w-full overflow-x-hidden">

  <!-- ===== FLORES ARRIBA - FULL WIDTH ===== -->
  <div class="relative w-full overflow-hidden" id="flores-arriba-hero" style="opacity: 1 !important;">
    <img
      src="/imagenes/FloresArriba.webp"
      alt="Flores decorativas"
      class="w-full h-auto object-cover object-center block"
      style="opacity: 1 !important;"
    />

    <!-- CORONA CENTRADA SOBRE LAS FLORES -->
    <div
      class="absolute left-1/2 transform -translate-x-1/2 top-[100px] sm:top-16 md:top-12 lg:top-8 xl:top-4 z-50"
      id="corona-hero"
    >
      <img
        src="/imagenes/Corona.webp"
        alt="Corona de quinceañera"
        class="w-24 h-auto sm:w-24 sm:h-24 md:w-28 md:h-28 lg:w-32 lg:h-32 xl:w-36 xl:h-36 object-contain mx-auto"
      />
    </div>
  </div>

  <!-- ===== CONTENIDO CENTRAL ===== -->
  <div class="relative w-full overflow-x-hidden sm:pt-40 md:pt-48 px-2 sm:px-4">
    <div class="flex justify-center w-full">
      <div class="text-center z-10 max-w-4xl w-full">

        <!-- TEXTO: MIS XV AÑOS -->
        <div class="relative text-center z-30 mb-8 w-full px-2" id="titulo-container-hero">
          <h1
            class="font-crimson text-xl sm:text-2xl md:text-3xl lg:text-4xl xl:text-5xl text-[#95303a] font-bold tracking-wider"
            id="titulo-hero"
          >
            MIS XV AÑOS
          </h1>
        </div>

        <!-- NOMBRE CON MARIPOSAS A LOS LADOS -->
        <div
          class="flex items-center justify-center gap-2 sm:gap-8 md:gap-16 lg:gap-24 mb-8 w-full px-2"
          id="nombre-container-hero"
        >
          <!-- MARIPOSA IZQUIERDA -->
          <div id="mariposa-izq-hero" class="flex-shrink-0">
            <img
              src="/gif/MariposaRoja.gif"
              alt="Mariposa izquierda"
              class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 lg:w-14 lg:h-14 object-contain"
            />
          </div>

          <!-- NOMBRE -->
          <h2
            class="font-great-vibes text-5xl sm:text-6xl md:text-7xl lg:text-8xl text-[#a27735] tracking-wide flex-shrink min-w-0"
            id="nombre-typewriter-hero"
          ></h2>

          <!-- MARIPOSA DERECHA -->
          <div id="mariposa-der-hero" class="flex-shrink-0">
            <img
              src="/gif/MariposaRoja.gif"
              alt="Mariposa derecha"
              class="w-8 h-8 sm:w-10 sm:h-10 md:w-12 md:h-12 lg:w-14 lg:h-14 object-contain scale-x-[-1]"
            />
          </div>
        </div>

        <!-- ===== IMAGEN PRINCIPAL CON FLORES LATERALES ===== -->
        <div class="relative w-full overflow-visible px-2" id="foto-container-hero">
          <!-- FLORES IZQUIERDA -->
          <div id="flores-foto-izq-hero" class="absolute left-0 sm:left-2 top-32 sm:top-40 md:top-32 lg:top-24 flex-shrink-0 z-30">
            <img
              src="/imagenes/FloresIzquierda.webp"
              alt="Flores izquierda"
              class="w-10 h-auto sm:w-12 md:w-16 lg:w-20 object-contain"
            />
          </div>

          <!-- FLORES DERECHA -->
          <div id="flores-foto-der-hero" class="absolute right-0 sm:right-2 top-32 sm:top-40 md:top-32 lg:top-24 flex-shrink-0 z-30">
            <img
              src="/imagenes/FloresDerecha.webp"
              alt="Flores derecha"
              class="w-10 h-auto sm:w-12 md:w-16 lg:w-20 object-contain"
            />
          </div>

          <!-- IMAGEN DE LA QUINCEAÑERA -->
          <div class="relative flex justify-center">
            <img
              src="/imagenes/xv.webp"
              alt="Foto de quinceañera"
              class="w-full max-w-[90vw] sm:max-w-[80vw] md:max-w-[70vw] lg:max-w-[60vw] xl:max-w-[50vw] h-auto object-contain"
              id="foto-quinceañera-hero"
            />
          </div>
        </div>

      </div>
    </div>
  </div>

</section>

<!-- ===== ANIMACIONES GSAP ===== -->
<script>
  import { gsap } from "gsap";
  import { ScrollTrigger } from "gsap/ScrollTrigger";

  gsap.registerPlugin(ScrollTrigger);

  let heroScrollTrigger = null;
  let butterflyAnimations: gsap.core.Tween[] = [];

  // Detectar móvil
  const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);

  // Configuración para móviles
  if (isMobile) {
    ScrollTrigger.config({
      autoRefreshEvents: "visibilitychange,DOMContentLoaded,load,resize",
      ignoreMobileResize: true
    });
  }

  function initHeroAnimations() {
    console.log("✨ Iniciando animaciones del Hero...");

    // Destruir animaciones anteriores si existen
    if (heroScrollTrigger) {
      heroScrollTrigger.kill();
    }
    
    butterflyAnimations.forEach(anim => {
      if (anim && anim.kill) {
        anim.kill();
      }
    });
    butterflyAnimations = [];

    // Forzar opacidad completa en flores superiores
    gsap.set("#flores-arriba-hero", { clearProps: "all" });

    // CORONA - Zoom in
    gsap.fromTo(
      "#corona-hero",
      { opacity: 0, scale: 0.5 },
      { opacity: 1, scale: 1, duration: 1.2, ease: "back.out(1.2)", delay: 0.3 }
    );

    // TÍTULO - Fade in de arriba
    gsap.fromTo(
      "#titulo-hero",
      { opacity: 0, y: 30 },
      { opacity: 1, y: 0, duration: 1, ease: "power2.out", delay: 0.5 }
    );

    // MARIPOSA IZQUIERDA - Llega de la izquierda
    gsap.fromTo(
      "#mariposa-izq-hero",
      { opacity: 0, x: -50, y: 20, rotation: -15, scale: 0.8 },
      { opacity: 1, x: 0, y: 0, rotation: 0, scale: 1, duration: 4, ease: "power2.out" }
    );

    // MARIPOSA IZQUIERDA - Flotado con movimiento elegante
    const anim1 = gsap.to("#mariposa-izq-hero", {
      y: -12,
      rotation: 3,
      duration: 3,
      ease: "sine.inOut",
      yoyo: true,
      repeat: -1,
      delay: 1.5
    });
    butterflyAnimations.push(anim1);

    const anim2 = gsap.to("#mariposa-izq-hero", {
      x: 10,
      duration: 4,
      ease: "sine.inOut",
      yoyo: true,
      repeat: -1,
      delay: 1.5
    });
    butterflyAnimations.push(anim2);

    // MARIPOSA DERECHA - Llega de la derecha
    gsap.fromTo(
      "#mariposa-der-hero",
      { opacity: 0, x: 50, y: 20, rotation: 15, scale: 0.8 },
      { opacity: 1, x: 0, y: 0, rotation: 0, scale: 1, duration: 4, ease: "power2.out" }
    );

    // MARIPOSA DERECHA - Flotado con movimiento elegante
    const anim3 = gsap.to("#mariposa-der-hero", {
      y: -12,
      rotation: -3,
      duration: 3,
      ease: "sine.inOut",
      yoyo: true,
      repeat: -1,
      delay: 1.5
    });
    butterflyAnimations.push(anim3);

    const anim4 = gsap.to("#mariposa-der-hero", {
      x: -10,
      duration: 4,
      ease: "sine.inOut",
      yoyo: true,
      repeat: -1,
      delay: 1.5
    });
    butterflyAnimations.push(anim4);

    // FLORES IZQUIERDA - Salen de la izquierda
    gsap.fromTo(
      "#flores-foto-izq-hero",
      { opacity: 0, x: -150 },
      { opacity: 1, x: 0, duration: 1.5, ease: "power2.out", delay: 0.7 }
    );

    // FLORES DERECHA - Salen de la derecha
    gsap.fromTo(
      "#flores-foto-der-hero",
      { opacity: 0, x: 150 },
      { opacity: 1, x: 0, duration: 1.5, ease: "power2.out", delay: 0.7 }
    );

    // NOMBRE - Efecto cascada letra por letra
    function nombreCascadaElegante() {
      const texto = "Lucia";
      const contenedor = document.getElementById("nombre-typewriter-hero");
      if (!contenedor) return;

      contenedor.innerHTML = texto
        .split("")
        .map(
          (letra, index) =>
            `<span class="letra-cascada-hero" style="
                opacity: 0; 
                display: inline-block; 
                transform: translateY(30px) scale(0.8);
                filter: blur(2px);
            ">${letra}</span>`
        )
        .join("");

      gsap.to(".letra-cascada-hero", {
        opacity: 1,
        y: 0,
        scale: 1,
        filter: "blur(0px)",
        duration: 0.8,
        ease: "back.out(1.6)",
        stagger: { each: 0.12, from: "start" },
      });
    }

    // IMAGEN PRINCIPAL - Fade in con zoom
    gsap.fromTo(
      "#foto-container-hero",
      { opacity: 0, scale: 0.8, y: 30 },
      { opacity: 1, scale: 1, y: 0, duration: 1.2, ease: "power2.out" }
    );

    nombreCascadaElegante();
    console.log("✨ Animaciones del Hero listas!");
  }

  // INICIALIZACIÓN CON MÚLTIPLES EVENTOS
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHeroAnimations);
  } else {
    initHeroAnimations();
  }

  // Refresh después de que todo cargue
  window.addEventListener('load', () => {
    setTimeout(() => {
      ScrollTrigger.refresh();
      console.log("🔄 ScrollTrigger refreshed - Hero");
    }, 100);
  });

  // Cleanup al salir
  window.addEventListener('beforeunload', () => {
    if (heroScrollTrigger) {
      heroScrollTrigger.kill();
    }
    butterflyAnimations.forEach(anim => {
      if (anim && anim.kill) {
        anim.kill();
      }
    });
  });
</script>

<style>
  /* Forzar opacidad completa en flores superiores */
  #flores-arriba-hero,
  #flores-arriba-hero img {
    opacity: 1 !important;
  }

  .letra-cascada-hero {
    transition: all 0.3s ease;
    will-change: transform, opacity, filter;
    position: relative;
  }

  .letra-cascada-hero:hover {
    transform: translateY(-3px) scale(1.05) !important;
    text-shadow: 0 0 12px rgba(162, 119, 53, 0.5) !important;
  }

  /* Prevenir scroll horizontal */
  section {
    max-width: 100vw;
    overflow-x: hidden;
  }
</style>